# Story 2.3 â€” Get run API (detail by id)
Story ID: S2.3
Epic ID: E2



Status: Ready

User Story
- As an API consumer (Frontend Run Detail),
- I want GET /backtests/{id} to return metadata and artifact references for a run,
- So that I can display a specific run, locate its artifacts, and decide if playback is available.

Context
- Completes the read path for a single run using Catalog adapter joins.


Dependencies
- Depends on: S2.1 (models + SQLite adapter)
- Blocks: S6.2 (Run Detail UI)

References
- API Contracts: docs/api/openapi.yaml
- Catalog: docs/api/catalog.md
- Source Tree: docs/architecture/source-tree.md
- Data Models: docs/architecture.md
- Error Codes: docs/api/error-codes.md

Definition of Ready
- Context clarified; dependencies and references listed
- ACs measurable and testable; cite canonical docs
- QA mapping present (see docs/qa/story-to-qa-mapping.md)

Acceptance Criteria
1) GET /backtests/{id} returns 200 with `Run` shape when found; 404 with `{ error: { code:"RUN_NOT_FOUND", message } }` when missing
2) Response includes: `run_id, dataset_id, strategy_id, params, seed, slippage_fees, speed, code_hash, created_at, status, duration_ms`
3) Artifacts object present with paths: `metrics_path, equity_path, orders_path, fills_path, run_manifest_path`
4) Optionally include `manifest` link `{ path }` if recorded, or omit/null if not yet present
5) All timestamps are ISO-8601 UTC strings; types map correctly from DB TEXT/JSON columns
6) Lint passes; handler non-blocking; logs include run_id

Dev Notes (sourced from architecture docs)
- API Contracts: GET /backtests/{id} shape and error style [Source: architecture.md#api-contracts-rest--websocket]
- Data Models: `Run` fields, artifacts set, manifest [Source: architecture.md#data-models]
- Catalog Schema: `runs` table has JSON/TEXT columns for params and slippage_fees, and artifact paths [Source: architecture.md#catalog-schema-sqlite-ddl]

Technical Specifications
- SQL: SELECT from `runs` by run_id; optionally join `datasets` if symbol/date context needed later
- JSON columns: parse `params_json`, `slippage_fees_json` to objects
- Paths: return as-is (repo-relative recommended); do not touch filesystem
- Error: 404 with standardized error object

Tasks / Subtasks
- Implement `get_run(run_id)` in adapters/sqlite_catalog.py: return row mapped to `Run` dict or None
- Add service method in services/backtests.py to fetch and map to response shape; raise 404 error on None
- Update api/routes/backtests.py GET /backtests/{id} to call service and return mapped JSON or standardized error
- `make lint` on backend/

Testing & Validation
- Fresh DB: GET unknown id -> 404 error shape
- After inserting a sample row (manual SQL or later stories), GET /backtests/{id} returns full shape with parsed JSON and paths

Definition of Done
- Endpoint returns correct `Run` detail shape, including artifact references, with proper error handling and types.

