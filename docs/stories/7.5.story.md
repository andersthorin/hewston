# Story 7.5 â€” Operability hooks: structured logs and minimal counters
Story ID: S7.5
Epic ID: E7

Status: Ready for Review

User Story
- As an operator and developer,
- I want structured logs and minimal counters for playback and jobs,
- So that I can observe health, diagnose issues, and validate NFRs locally.

Context
- Complements performance test plan and coding standards. Minimal, local-first.

Dependencies
- Depends on: S1.x backend skeleton; S5.x streamer if emitting frame counters

Definition of Ready
- Coding standards reviewed; decide logging fields and counter names
- Performance plan reviewed for required measurements
- Error codes reviewed for alignment

- Blocks: N/A (quality/hardening)

References
- Coding standards: docs/architecture/coding-standards.md
- Performance test plan: docs/qa/performance-test-plan.md
- Error codes: docs/api/error-codes.md

Acceptance Criteria
1) Logging
   - JSON logs via structlog include at minimum: timestamp, level, message, request_id (REST), run_id (where applicable)
   - Backtest job logs include run_id and duration_ms; dataset jobs include dataset_id and sizes
2) Playback counters (when streamer implemented)
   - Emit frames_produced, frames_sent, frames_dropped counters periodically
   - Include dropped counter in StreamFrame as specified
3) Error logging
   - Errors use canonical codes from error-codes.md; no stack traces leaked in messages (stack separately available in debug)
4) Documentation
   - Update coding-standards.md with logging fields and counter expectations
   - Note log fields in Architecture Operability section (optional)

Definition of Done
- Logs/counters visible during local runs; coding standards updated accordingly; aligns with performance test plan measurements.



Dev Agent Record
- Agent Model Used: dev (James)

Changes Implemented
- Added JSON logging summary for streamer (frames_total_rows, frames_stride, frames_produced, frames_dropped_est)
- Added SSE end log with frames_sent/frames_dropped; WS disconnect already logs same
- Clarified logging standards with event names and required fields in docs/architecture/coding-standards.md

Files Touched
- Modified: backend/services/streamer.py (stream.summary logs)
- Modified: backend/api/routes/backtests.py (SSE counters + sse.end log)
- Modified: docs/architecture/coding-standards.md (logging fields/events)

Notes
- Current implementation uses stdlib JSON formatter (MVP). Structlog integration pending dependency approval.
- Playback frames include dropped field; worker aggregates queue drops into cumulative dropped.
