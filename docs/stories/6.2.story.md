# Story 6.2 — Run Detail playback view (charts + controls)
Story ID: S6.2
Epic ID: E6



Status: Ready

User Story
- As an owner-operator,
- I want a Run Detail view that plays back a completed run with chart, equity, and orders/fills overlays,
- So that I can analyze performance interactively.

Context
- Uses WS primary + SSE fallback transport. Presentational components receive props only; containers wire data and controls.


Dependencies
- Depends on: S2.3 (Get run API), S5.2 (WS transport), S6.3 (WS hook + Worker)
- Blocks: None

References
- UX Spec: docs/front-end-spec.md
- Wireframes: docs/ui/wireframes/run-detail.md
- Component Map: docs/frontend/component-map.md
- WS Protocol: docs/api/ws-protocol.md
- API: docs/api/openapi.yaml

Definition of Ready
- UX assets linked (wireframe + component map)
- ACs measurable and testable; cite canonical docs
- QA mapping present (see docs/qa/story-to-qa-mapping.md)

Acceptance Criteria
1) View loads run metadata via GET /backtests/{id} and shows basic info (strategy, dates, status)
2) Connects to ws://localhost:8000/backtests/{id}/ws; on connect, begins playback; shows dropped counter if present
3) Controls: Play/Pause, Seek (datetime input/slider), Speed (select) — send ctrl messages over WS
4) Charts: OHLC (Lightweight Charts) + orders/fills overlays; Equity mini-chart
5) SSE fallback toggle (if WS fails) switches to GET /backtests/{id}/stream?speed=60 and continues playback (read-only)
6) Components are presentational (Chart, Equity, Controls); containers/services handle WS/SSE and state
7) Lint passes; smooth interaction without major jank on M2-class hardware

Dev Notes (sourced from architecture docs)
- WS protocol (ctrl/frame/end/err/hb) and SSE fallback [Source: architecture.md#playback-channel-protocol-websocket]
- Frontend architecture boundaries & Tech Stack [Source: architecture.md#source-tree-and-module-boundaries][Source: architecture.md#tech-stack]
- NFRs: ≈30 FPS target; drop-oldest policy; non-blocking [Source: architecture.md#non-functional-requirements-and-performance-budgets]

Technical Specifications
- Files/paths:
  - frontend/src/views/RunDetail.tsx — orchestrates containers + components
  - frontend/src/containers/RunPlayerContainer.tsx — wires services/ws.ts and workers/streamParser.ts
  - frontend/src/components/PlaybackControls.tsx — play/pause/seek/speed UI
  - frontend/src/components/ChartOHLC.tsx — OHLC chart + overlays props
  - frontend/src/components/EquityChart.tsx — equity mini-chart
- Services/Worker (see Story 6.3) provide frame stream and control methods
- Props:
  - Controls props: { playing, speed, onPlay, onPause, onSeek, onSpeedChange }
  - ChartOHLC props: { candles, overlays, lastTs }
  - EquityChart props: { series, lastTs }

Tasks / Subtasks
- Implement RunDetail view skeleton; fetch run metadata via services/api.ts
- Build presentational components: PlaybackControls, ChartOHLC, EquityChart
- Build RunPlayerContainer to connect WS/SSE services and map to component props
- Wire SSE fallback toggle
- Ensure rendering throttled appropriately (requestAnimationFrame) to maintain smoothness
- Run ESLint/Prettier

Testing & Validation
- With a DONE run, open view; observe playback and controls
- Toggle pause/play/seek/speed; verify behavior and chart updates
- Induce WS failure and verify SSE fallback continues to stream

Definition of Done
- Run Detail provides smooth playback with controls and overlays; presentational components only; WS primary + SSE fallback operational.
